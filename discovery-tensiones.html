<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discovery Matriz de Tensiones - Sunstone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); }
        .tension-matrix { display: grid; grid-template-columns: 1fr 1fr; gap: 1px; background: #6b7280; }
        .matrix-cell { background: white; min-height: 200px; padding: 1rem; position: relative; }
        .matrix-header { background: #f3f4f6; padding: 0.75rem; font-weight: 600; text-align: center; }
        .matrix-label { position: absolute; top: 0.5rem; left: 0.5rem; font-size: 0.75rem; font-weight: 500; color: #6b7280; }
        .tension-item { background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 0.75rem; margin-bottom: 0.5rem; cursor: pointer; transition: all 0.2s; }
        .tension-item:hover { background: #f3f4f6; transform: translateY(-1px); }
        .audience-selector { background: #fef3c7; border: 1px solid #f59e0b; }
        .push-pull-icon { font-size: 1.5rem; margin-bottom: 0.5rem; }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <i class="fas fa-gem text-2xl text-indigo-600 mr-3"></i>
                        <span class="text-xl font-bold text-gray-900">Sunstone</span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors">
                        <i class="fas fa-plus mr-2"></i>Nueva sesión
                    </button>
                    <button class="text-gray-600 hover:text-gray-900 px-4 py-2 border border-gray-300 rounded-lg">
                        <i class="fas fa-download mr-2"></i>Exportar
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="flex">
        <!-- Project Sidebar -->
        <div class="w-64 bg-white shadow-lg min-h-screen">
            <div class="p-6">
                <div class="mb-6">
                    <h3 id="projectName" class="text-lg font-semibold text-gray-900 mb-2">TechFlow Solutions</h3>
                    <p id="projectInfo" class="text-sm text-gray-600">B2B SaaS • En Discovery</p>
                </div>
                <nav class="space-y-2">
                    <a href="project.html" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg">
                        <i class="fas fa-chart-pie mr-3"></i>
                        <span>Overview</span>
                    </a>
                    <a href="#" class="flex items-center px-4 py-3 text-gray-700 bg-gray-100 rounded-lg">
                        <i class="fas fa-search mr-3"></i>
                        <span class="font-medium">Discovery</span>
                    </a>
                    <a href="#" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg">
                        <i class="fas fa-chess mr-3"></i>
                        <span>Estrategia</span>
                    </a>
                    <a href="#" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg">
                        <i class="fas fa-funnel-dollar mr-3"></i>
                        <span>GTM & Funnels</span>
                    </a>
                    <a href="#" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg">
                        <i class="fas fa-tasks mr-3"></i>
                        <span>Roadmap</span>
                    </a>
                    <a href="#" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg">
                        <i class="fas fa-file-alt mr-3"></i>
                        <span>Reportes</span>
                    </a>
                </nav>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-8">
            <!-- Header -->
            <div class="mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900 mb-2">Discovery - Matriz de Tensiones</h1>
                        <p class="text-gray-600">Mapea las fuerzas que impulsan y limitan el cambio</p>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="saveTensionesData()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                            <i class="fas fa-save mr-2"></i>Guardar
                        </button>
                        <button onclick="completeTensiones()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-check mr-2"></i>Completar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Audience Selector -->
            <div class="mb-6">
                <div class="audience-selector rounded-lg p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-medium text-gray-900">Audiencia seleccionada</h3>
                            <p class="text-sm text-gray-600">Equipo de ventas B2B • 5-10 personas • SaaS</p>
                        </div>
                        <button class="bg-white px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50">
                            <i class="fas fa-users mr-2"></i>Cambiar audiencia
                        </button>
                    </div>
                </div>
            </div>

            <!-- Matrix -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="tension-matrix">
                    <!-- Push + Inercia -->
                    <div class="matrix-cell">
                        <div class="matrix-header bg-blue-100">
                            <div class="push-pull-icon text-blue-600">
                                <i class="fas fa-arrow-up"></i>
                            </div>
                            <div class="font-semibold text-blue-900">Push (Impulso)</div>
                            <div class="text-sm text-blue-700">Lo que empuja hacia el cambio</div>
                        </div>
                        <div class="matrix-label">Inercia</div>
                        <div class="mt-8 space-y-2">
                            <div class="tension-item">
                                <div class="font-medium text-sm text-gray-900">Pérdida de oportunidades</div>
                                <div class="text-xs text-gray-600">Por no seguimiento oportuno</div>
                            </div>
                            <div class="tension-item">
                                <div class="font-medium text-sm text-gray-900">Sobrecarga administrativa</div>
                                <div class="text-xs text-gray-600">60% del tiempo en tareas no productivas</div>
                            </div>
                            <button onclick="addTensionItem('push-inercia')" class="w-full p-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-gray-400 hover:text-gray-600">
                                <i class="fas fa-plus mr-2"></i>Agregar push
                            </button>
                        </div>
                    </div>

                    <!-- Pull + Inercia -->
                    <div class="matrix-cell">
                        <div class="matrix-header bg-green-100">
                            <div class="push-pull-icon text-green-600">
                                <i class="fas fa-arrow-down"></i>
                            </div>
                            <div class="font-semibold text-green-900">Pull (Atracción)</div>
                            <div class="text-sm text-green-700">Lo que atrae hacia la nueva solución</div>
                        </div>
                        <div class="matrix-label">Inercia</div>
                        <div class="mt-8 space-y-2">
                            <div class="tension-item">
                                <div class="font-medium text-sm text-gray-900">Automatización inteligente</div>
                                <div class="text-xs text-gray-600">Reduce tareas repetitivas</div>
                            </div>
                            <div class="tension-item">
                                <div class="font-medium text-sm text-gray-900">Insights predictivos</div>
                                <div class="text-xs text-gray-600">IA sugiere próximos pasos</div>
                            </div>
                            <button onclick="addTensionItem('pull-inercia')" class="w-full p-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-gray-400 hover:text-gray-600">
                                <i class="fas fa-plus mr-2"></i>Agregar pull
                            </button>
                        </div>
                    </div>

                    <!-- Push + Ansiedad -->
                    <div class="matrix-cell">
                        <div class="matrix-header bg-red-100">
                            <div class="push-pull-icon text-red-600">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="font-semibold text-red-900">Ansiedad</div>
                            <div class="text-sm text-red-700">Preocupaciones sobre el cambio</div>
                        </div>
                        <div class="matrix-label">Ansiedad</div>
                        <div class="mt-8 space-y-2">
                            <div class="tension-item">
                                <div class="font-medium text-sm text-gray-900">Miedo a perder control</div>
                                <div class="text-xs text-gray-600">Sobre el proceso de venta</div>
                            </div>
                            <div class="tension-item">
                                <div class="font-medium text-sm text-gray-900">Complejidad de implementación</div>
                                <div class="text-xs text-gray-600">Tiempo de setup y aprendizaje</div>
                            </div>
                            <button onclick="addTensionItem('push-ansiedad')" class="w-full p-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-gray-400 hover:text-gray-600">
                                <i class="fas fa-plus mr-2"></i>Agregar ansiedad
                            </button>
                        </div>
                    </div>

                    <!-- Pull + Ansiedad -->
                    <div class="matrix-cell">
                        <div class="matrix-header bg-purple-100">
                            <div class="push-pull-icon text-purple-600">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="font-semibold text-purple-900">Seguridad</div>
                            <div class="text-sm text-purple-700">Lo que reduce las preocupaciones</div>
                        </div>
                        <div class="matrix-label">Ansiedad</div>
                        <div class="mt-8 space-y-2">
                            <div class="tension-item">
                                <div class="font-medium text-sm text-gray-900">Onboarding guiado</div>
                                <div class="text-xs text-gray-600">Acompañamiento paso a paso</div>
                            </div>
                            <div class="tension-item">
                                <div class="font-medium text-sm text-gray-900">Soporte 24/7</div>
                                <div class="text-xs text-gray-600">Ayuda cuando sea necesario</div>
                            </div>
                            <button onclick="addTensionItem('pull-ansiedad')" class="w-full p-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-gray-400 hover:text-gray-600">
                                <i class="fas fa-plus mr-2"></i>Agregar seguridad
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Summary -->
            <div class="mt-8 bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Resumen de tensiones</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-600">2</div>
                        <div class="text-sm text-gray-600">Fuerzas Push</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-600">2</div>
                        <div class="text-sm text-gray-600">Fuerzas Pull</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-red-600">2</div>
                        <div class="text-sm text-gray-600">Ansiedades</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-purple-600">2</div>
                        <div class="text-sm text-gray-600">Seguridades</div>
                    </div>
                </div>
                
                <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                    <h4 class="font-medium text-gray-900 mb-2">Insights clave</h4>
                    <ul class="text-sm text-gray-600 space-y-1">
                        <li>• La sobrecarga administrativa es el principal impulsor del cambio</li>
                        <li>• La automatización inteligente es el mayor atractivo</li>
                        <li>• El miedo a perder control es la principal barrera</li>
                        <li>• El onboarding guiado reduce la ansiedad significativamente</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Tension Item Modal -->
    <div id="addTensionModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-md w-full">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900" id="modalTitle">Agregar nuevo elemento</h2>
                        <button onclick="closeAddTensionModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Título</label>
                            <input type="text" id="tensionTitle" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Ej: Pérdida de oportunidades">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Descripción</label>
                            <textarea id="tensionDescription" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" rows="2" placeholder="Contexto adicional..."></textarea>
                        </div>
                    </div>

                    <div class="flex justify-end space-x-4 mt-8">
                        <button onclick="closeAddTensionModal()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                            Cancelar
                        </button>
                        <button onclick="saveTensionItem()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors">
                            Agregar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentProject = null;
        let tensionesData = {
            pushInercia: [],
            pullInercia: [],
            pushAnsiedad: [],
            pullAnsiedad: []
        };
        let currentTensionType = '';

        function persistCurrentProject() {
            if (!currentProject) return;

            localStorage.setItem('sunstone_current_project', JSON.stringify(currentProject));

            const projects = JSON.parse(localStorage.getItem('sunstone_projects') || '[]');
            const projectIndex = projects.findIndex(p => p.id === currentProject.id);
            if (projectIndex !== -1) {
                projects[projectIndex] = currentProject;
                localStorage.setItem('sunstone_projects', JSON.stringify(projects));
            }
        }


        function loadCurrentProject() {
            const saved = localStorage.getItem('sunstone_current_project');
            if (saved) {
                currentProject = JSON.parse(saved);
                if (currentProject.discovery && currentProject.discovery.tensiones) {
                    tensionesData = currentProject.discovery.tensiones.data || {
                        pushInercia: [],
                        pullInercia: [],
                        pushAnsiedad: [],
                        pullAnsiedad: []
                    };
                    renderTensiones();
                }
                
                // Update project name in sidebar
                const projectNameEl = document.getElementById('projectName');
                const projectInfoEl = document.getElementById('projectInfo');
                if (projectNameEl) projectNameEl.textContent = currentProject.name;
                if (projectInfoEl) projectInfoEl.textContent = `${currentProject.modelType || 'SaaS'} • ${currentProject.status}`;
            }
        }

        function saveTensionesData() {
            if (!currentProject) return;

            if (!currentProject.discovery) currentProject.discovery = {};
            if (!currentProject.discovery.tensiones) {
                currentProject.discovery.tensiones = { completed: false, data: tensionesData };
            } else {
                currentProject.discovery.tensiones.data = tensionesData;
                currentProject.discovery.tensiones.completed =
                    currentProject.discovery.tensiones.completed || false;
            }

            persistCurrentProject();
        }


        function renderTensiones() {
            // Clear existing items
            document.querySelectorAll('.tension-item').forEach(item => item.remove());
            
            // Render push-inercia
            tensionesData.pushInercia.forEach((item, index) => {
                addTensionItemToDOM('push-inercia', item, index);
            });
            
            // Render pull-inercia
            tensionesData.pullInercia.forEach((item, index) => {
                addTensionItemToDOM('pull-inercia', item, index);
            });
            
            // Render push-ansiedad
            tensionesData.pushAnsiedad.forEach((item, index) => {
                addTensionItemToDOM('push-ansiedad', item, index);
            });
            
            // Render pull-ansiedad
            tensionesData.pullAnsiedad.forEach((item, index) => {
                addTensionItemToDOM('pull-ansiedad', item, index);
            });
            
            updateSummary();
        }

        function addTensionItemToDOM(type, item, index) {
            const newItem = document.createElement('div');
            newItem.className = 'tension-item';
            newItem.innerHTML = `
                <div class="font-medium text-sm text-gray-900">${item.title}</div>
                ${item.description ? `<div class="text-xs text-gray-600">${item.description}</div>` : ''}
                <div class="mt-2 flex space-x-2">
                    <button onclick="editTensionItem('${type}', ${index})" class="text-blue-600 hover:text-blue-800 text-xs">
                        <i class="fas fa-edit mr-1"></i>Editar
                    </button>
                    <button onclick="deleteTensionItem('${type}', ${index})" class="text-red-600 hover:text-red-800 text-xs">
                        <i class="fas fa-trash mr-1"></i>Eliminar
                    </button>
                </div>
            `;

            const cellMap = {
                'push-inercia': 0,
                'pull-inercia': 1,
                'push-ansiedad': 2,
                'pull-ansiedad': 3
            };

            const cells = document.querySelectorAll('.matrix-cell');
            const targetCell = cells[cellMap[type]];
            const addButton = targetCell.querySelector('button');
            targetCell.insertBefore(newItem, addButton);
        }

        function addTensionItem(type) {
            currentTensionType = type;
            const titles = {
                'push-inercia': 'Agregar Push (Impulso)',
                'pull-inercia': 'Agregar Pull (Atracción)',
                'push-ansiedad': 'Agregar Ansiedad',
                'pull-ansiedad': 'Agregar Seguridad'
            };
            
            document.getElementById('modalTitle').textContent = titles[type];
            document.getElementById('addTensionModal').classList.remove('hidden');
        }

        function closeAddTensionModal() {
            document.getElementById('addTensionModal').classList.add('hidden');
            document.getElementById('tensionTitle').value = '';
            document.getElementById('tensionDescription').value = '';
        }

        function saveTensionItem() {
            const title = document.getElementById('tensionTitle').value;
            const description = document.getElementById('tensionDescription').value;

            if (title) {
                const newItem = {
                    title,
                    description
                };

                switch(currentTensionType) {
                    case 'push-inercia':
                        tensionesData.pushInercia.push(newItem);
                        break;
                    case 'pull-inercia':
                        tensionesData.pullInercia.push(newItem);
                        break;
                    case 'push-ansiedad':
                        tensionesData.pushAnsiedad.push(newItem);
                        break;
                    case 'pull-ansiedad':
                        tensionesData.pullAnsiedad.push(newItem);
                        break;
                }

                saveTensionesData();
                renderTensiones();
                closeAddTensionModal();
                window.SunstoneUtils.showNotification('Elemento agregado exitosamente', 'success');
            } else {
                window.SunstoneUtils.showNotification('Por favor ingresa un título', 'error');
            }
        }

        function editTensionItem(type, index) {
            const item = tensionesData[type][index];
            
            document.getElementById('tensionTitle').value = item.title;
            document.getElementById('tensionDescription').value = item.description || '';
            
            currentTensionType = type;
            
            const titles = {
                'pushInercia': 'Editar Push (Impulso)',
                'pullInercia': 'Editar Pull (Atracción)',
                'pushAnsiedad': 'Editar Ansiedad',
                'pullAnsiedad': 'Editar Seguridad'
            };
            
            document.getElementById('modalTitle').textContent = titles[type];
            
            // Store current index and type for update
            document.getElementById('saveTensionItem').dataset.index = index;
            document.getElementById('saveTensionItem').dataset.type = type;
            
            document.getElementById('addTensionModal').classList.remove('hidden');
        }

        function deleteTensionItem(type, index) {
            if (confirm('¿Estás seguro de que quieres eliminar este elemento?')) {
                tensionesData[type].splice(index, 1);
                saveTensionesData();
                renderTensiones();
                window.SunstoneUtils.showNotification('Elemento eliminado exitosamente', 'success');
            }
        }

        function updateSummary() {
            const pushCount = tensionesData.pushInercia.length;
            const pullCount = tensionesData.pullInercia.length;
            const ansiedadCount = tensionesData.pushAnsiedad.length;
            const seguridadCount = tensionesData.pullAnsiedad.length;
            
            // Update summary stats
            const statsElements = document.querySelectorAll('.text-2xl.font-bold');
            if (statsElements.length >= 4) {
                statsElements[0].textContent = pushCount;
                statsElements[1].textContent = pullCount;
                statsElements[2].textContent = ansiedadCount;
                statsElements[3].textContent = seguridadCount;
            }
        }

        function completeTensiones() {
            const totalItems = tensionesData.pushInercia.length + tensionesData.pullInercia.length + 
                             tensionesData.pushAnsiedad.length + tensionesData.pullAnsiedad.length;
            
            if (totalItems < 4) {
                window.SunstoneUtils.showNotification('Por favor agrega al menos un elemento en cada cuadrante antes de completar', 'error');
                return;
            }
            
            if (currentProject) {
                if (!currentProject.discovery) currentProject.discovery = {};
                if (!currentProject.discovery.tensiones) {
                    currentProject.discovery.tensiones = { data: tensionesData, completed: true };
                } else {
                    currentProject.discovery.tensiones.data = tensionesData;
                    currentProject.discovery.tensiones.completed = true;
                }

                persistCurrentProject();
            }

            
            window.SunstoneUtils.showNotification('Matriz de tensiones completada exitosamente', 'success');
            
            setTimeout(() => {
                window.location.href = 'project.html';
            }, 1500);
        }

        function saveTensionesData() {
            // Data is already saved when adding/updating items
            window.SunstoneUtils.showNotification('Datos guardados exitosamente', 'success');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadCurrentProject();
        });
    </script>
    <script src="main.js"></script>
</body>
</html>